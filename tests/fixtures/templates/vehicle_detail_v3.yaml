template_id: "vehicle_detail_v3"
version: "2.0.0"
scope:
  domains: ["localhost"]
  url_patterns:
    - ".*/item/.*"
policy:
  transport: "http"
output:
  primary_table: "vehicles"
  upsert:
    key: ["registration_number"]
    strategy: "update"
fields:
  - name: "registration_number"
    type: "string"
    required: true
    selectors:
      - css: "dd"
    target:
      table: "vehicles"
      column: "registration_number"
  - name: "model_year"
    type: "number"
    selectors:
      - css: "[data-spec=modelYear]"
    transform:
      - name: "regex_sub"
        args: { pattern: "[^0-9]", repl: "" }
      - name: "parse_int"
    validate:
      - name: "not_empty"
    target:
      table: "vehicles"
      column: "model_year"
  - name: "co2_wltp"
    type: "number"
    selectors:
      - css: "#wltp-co2"
    transform:
      - name: "regex_sub"
        args: { pattern: " g/km", repl: "" }
      - name: "parse_decimal"
        args: { decimal_sep: "," }
    target:
      table: "vehicle_technical_specs"
      column: "wltp_co2_g_km"